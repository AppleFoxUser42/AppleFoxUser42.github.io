<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>A Primer on X-Remoting with VNC, RDP, XDMCP and SSH</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="A Primer on X-Remoting with VNC, RDP, XDMCP and SSH" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A primer on X-Remoting with VNC, RDP, XDMCP and SSH" />
<meta property="og:description" content="A primer on X-Remoting with VNC, RDP, XDMCP and SSH" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-16T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="A Primer on X-Remoting with VNC, RDP, XDMCP and SSH" />
<script type="application/ld+json">
{"url":"/2018/05/16/Primer_on_Remoting.html","@type":"BlogPosting","description":"A primer on X-Remoting with VNC, RDP, XDMCP and SSH","headline":"A Primer on X-Remoting with VNC, RDP, XDMCP and SSH","dateModified":"2018-05-16T00:00:00-05:00","datePublished":"2018-05-16T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2018/05/16/Primer_on_Remoting.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="/"></a></h1>
        
        

        <p></p>

        

        

        
      </header>
      <section>

      <small>16 May 2018</small>
<h1>A Primer on X-Remoting with VNC, RDP, XDMCP and SSH</h1>

<p class="view">by </p>

<h1 id="a-primer-on-x-remoting-with-vnc-rdp-xdmcp-and-ssh">A primer on X-Remoting with VNC, RDP, XDMCP and SSH</h1>

<p><strong>Tools used:</strong></p>
<ul>
  <li>vncserver</li>
  <li>xrdp</li>
  <li>xdm(cp)</li>
  <li>xpra</li>
  <li>ssh</li>
</ul>

<p><strong>Testplatforms - Server</strong>
A headless openSUSE VM and a headless FreeBSD VM without xserver installed.</p>

<p><strong>Testplatforms - Client</strong>
Any System with an Xserver and Xephyr installed. In this case a MacBook with macOS 10.12.6</p>

<p>There are different ways of remoting X-Applications from a server to a client. All with their own set of advantages and disadvantages. This article is comparing some of them and will explain how they are set up.</p>

<p>For most users who remotely access their Linux or BSD machines SSH will be enough. There is an easy way however to start applications on the host and have their GUI appear on the local machine.</p>

<p><strong>X-Forwarding over SSH</strong></p>

<p><code class="language-plaintext highlighter-rouge">ssh -X</code> and <code class="language-plaintext highlighter-rouge">ssh -Y</code>respectively allow for this. The difference between them is a reliance on <code class="language-plaintext highlighter-rouge">xauth</code>which might not be present on a pure server install without any X-Tools.</p>

<p>if <code class="language-plaintext highlighter-rouge">xauth</code> is present on the server the <code class="language-plaintext highlighter-rouge">-X</code> flag prompts <code class="language-plaintext highlighter-rouge">ssh</code> to create a temporarily valid session token in the <code class="language-plaintext highlighter-rouge">xauth</code> database which allows access to of the remote Xserver.
For X-Forwarding to work the server needs to have the <code class="language-plaintext highlighter-rouge">ForwardX11</code> flag enabled in it’s sshd_config file under /etc/ssh.
Unless <code class="language-plaintext highlighter-rouge">ForwardX11Trusted</code> is also enabled the access to the local Xserver granted to the remote server is handled as untrusted and restricted to the main <code class="language-plaintext highlighter-rouge">DISPLAY</code>. The session token in <code class="language-plaintext highlighter-rouge">xauth</code> expires 20min after the session is closed. This can be modified by setting a value for the ForwardX11Timeout flag in sshd_config (see <code class="language-plaintext highlighter-rouge">man ssh_config</code>).</p>

<p>If <code class="language-plaintext highlighter-rouge">xauth</code> is not present and therefore the creation of a ‘MAGIC COOKIE’ for the current session is not possible X-Forwarding may be enabled via the <code class="language-plaintext highlighter-rouge">-Y</code> flag in SSH which does not make use of the X11 SECURITY extension (see <code class="language-plaintext highlighter-rouge">man ssh</code>). Since xauth’s authentication mechanism is inherently flawed and weakly encrypted using <code class="language-plaintext highlighter-rouge">-Y</code> offers better security.</p>

<p>Advantages of X-forwarding over SSH are among others, that no window manager and no XServer are required as the window manager and Xserver of the host are used instead. There is no loss in image quality or resolution either as the settings of the local Xserver are used for this and, given the bandwidth, the application feels nearly local when used. Disadvantages are relatively high bandwidth requirements as the SSH protocol does not support UDP and the video stream is not compressed. It is for this very reason that some of the protocols in this article cannot be tunneled over ssh as they require UDP.
SSH requires TCP port 22 to be open.</p>

<p><strong>xpra</strong>
… is probably the most sophisticated X-Remoting tool on the list. Xpra acts as window manager and Xserver on the server and allows forwarding of not only single applications and full desktop sessions but allows for this in a plethora of   different ways. xpra can be accessed via tcp-sockets, ssh, ssl, tcp-aes and even over webrtc via browser or via memory mapped files on shared drives.
xpra also allows to forward GL-accelerated applications sound and devices and can make use of hardware accelerated decoding and encoding of the video stream in different formats. In it’s simplest form xpra does not require any configuration and can be started from the client via <code class="language-plaintext highlighter-rouge">xpra start ssh/user(at)server-ip --start-child=name-of-program</code>.</p>

<p>An advantage is that xpra can use common video codecs like h264 to reduce bandwidth required.<br />
One disadvantage of xpra is it’s long dependency-list. It is more suited for remoting of Desktops than servers.</p>

<p><strong>VNC</strong>
The <strong>V</strong>irtual <strong>N</strong>etwork <strong>C</strong>omputing protocol is the last in the list that can be run over SSH. VNC on Linux requires either a running Xserver to attach to using tools like x11vnc or the special Xvnc Xserver that creates VNC accessible virtual sessions.
<strong>Note:</strong> on FreeBSD Xvnc is neither in <code class="language-plaintext highlighter-rouge">pkg</code> nor in <code class="language-plaintext highlighter-rouge">ports</code> it is available, however as part of the <code class="language-plaintext highlighter-rouge">tightvnc</code> package.
To use Xvnc one usually uses the bundled vncserver tool. On first run it asks for a password to be set and from then on runs in the background listening for incomming VNC connections on ports 5900 to 5900+highest display number.
Depending on the configuration VNC creates a new session for each connection or allows connection to one session by multiple participants. To kill a session run <code class="language-plaintext highlighter-rouge">vncserver -kill :&lt;sessionnumber&gt;</code>
Xvnc, by default, looks for <code class="language-plaintext highlighter-rouge">$HOME/.vnc/xstartup</code> instead of  <code class="language-plaintext highlighter-rouge">$HOME/.xinitrc</code>. To use your users xinitrc replace xstartup with a symbolic link accordingly.</p>

<p><strong>xrdp</strong><br />
The <strong>R</strong>emote <strong>D</strong>esktop <strong>P</strong>rotocol was developed by Microsoft and ported to Linux and FreeBSD in the form of <code class="language-plaintext highlighter-rouge">xrdp</code> 
xrdp comes in two parts. the xrdp service and the <code class="language-plaintext highlighter-rouge">xrdp-sesman</code> the session manager.
RDP differs from VNC insofar as it’s not intended to attach to an existing session like <code class="language-plaintext highlighter-rouge">x11vnc</code> allows for but it intended to start a new session per connection. xrdp listens on tcp port <code class="language-plaintext highlighter-rouge">3389</code>
to automatically start xrdp at boot do <code class="language-plaintext highlighter-rouge">systemctl enable xrdp</code> and <code class="language-plaintext highlighter-rouge">systemctl enable xrdp-sesman</code> as root on linux.
On FreeBSD add <code class="language-plaintext highlighter-rouge">xrdp_enable="YES"</code> and <code class="language-plaintext highlighter-rouge">xrdp_sesman_enable="YES"</code> to /etc/rc.conf
xrdp, by default, looks for <code class="language-plaintext highlighter-rouge">$HOME/.Xsession</code> by default. Change this to your .xinitrc in <code class="language-plaintext highlighter-rouge">/etc/xrdp/sesman.ini</code> for linux and <code class="language-plaintext highlighter-rouge">/usr/local/etc/xrdp/sesman.ini</code> in FreeBSD</p>

<p><strong>XDMCP</strong>
… is a remoting protocol for the X display manager (xdm).<br />
xdm’s config can be found in /etc/X11/xdm on linux and /usr/etc/X11/xdm on FreeBSD.<br />
Important files are Xaccess, Xservers, Xsession and xdm-config.</p>

<p>xdm-config defines what files to use and is used to enable XDMCP.<br />
Xaccess functions as access control list (ACL) for clients.<br />
Xservers defines what X-servers to start at which tty. If the server is only used to remote into Xorg is not needed. Xvnc will do. An example line in Xservers might be <code class="language-plaintext highlighter-rouge">:0 local /usr/bin/Xvnc -nolisten tcp -br</code>
Finally, make sure to have a line utilizing your .xinitrc in Xsession if you use .xinitrc.</p>

<p>Xstartup, Xsession, Xreset, Xresources and Xwilling aren’t usually needed to be modified. These files handle Xresources and processes preceeding and superceeding the start of the user session such as the start of the chooser.</p>

<p>To query the X display manager from a remote machine, be it directly or indirectly, or have it broadcast its presence on the network the line <code class="language-plaintext highlighter-rouge">DisplayManager-requestPort: 0</code> has to be commented out: <code class="language-plaintext highlighter-rouge">!DisplayManager-requestPort: 0</code> in xdm-config. xdm listens on UDP port 177 for xdmcp requests.</p>

<p>Xaccess allows to set filter lists of who can acess xdm over xdmcp in what way. On trusted networks you usually want these two lines active.</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">*</span> <span class="c">#any host can get a login window
</span><span class="err">*</span> <span class="err">CHOOSER</span> <span class="err">BROADCAST</span> <span class="c">#any indirect host can get a chooser
</span></code></pre></div></div>




  <small>tags: <em></em></small>



      </section>
      <footer>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    
  </body>
</html>
